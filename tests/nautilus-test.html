<script src="tinytest.js"></script>
<script src="../scripts/nautilus.js"></script>
<script>

	nautilus.init(() => {

		tests({

			// nautilus.getStudentIds()
			'it should return an array of all available student IDs': function() {
				const students = nautilus.getStudentIds();
				assert(Array.isArray(students));
				eq(students[0], 'student1');
			},

			// nautilus.getAllResults(studentId)
			'it should return an array': function() {
				const results = nautilus.getAllResults('student1');
				assert(Array.isArray(results));
			},

			'it should return an array containing one object per LO in the entire product': function() {
				const results = nautilus.getAllResults('student1');
				eq(results.length, 288)
			},

			'each LO object should contain values for LO ID, status, best score, first score, attempts, time': function() {
				const results = nautilus.getAllResults('student1');
				const lo = results[0];
				eq(typeof lo.LO_id, 'string');
				eq(typeof lo.status, 'string');
				eq(typeof lo.first_score, 'number' || 'string');
				eq(typeof lo.best_score, 'number' || 'string');
				eq(typeof lo.attempts, 'number');
				eq(typeof lo.active_time, 'number');
			},

			'status should be "above target" if best score is 70 or higher, and "below target" if best score is lower than 70': function () {
				const results = nautilus.getAllResults('student1');
				for (let i = 0; i < results.length; i++) {
					if (results[i].best_score >= 70) {
						eq(results[i].status, 'aboveTarget')
					} else if (results[i].best_score < 70 && typeof results[i].best_score === 'number') {
						eq(results[i].status, 'belowTarget')
					}
				}
			},

			'each LO object should additionally contain a value for the LO name': function () {
				const results = nautilus.getAllResults('student1');
				const lo = results[200];
				eq(typeof lo.LO_name, 'string');
			},
			
			// nautilus.getUnitResults(studentId, unitName)
			'it should return an array containing one object per LO in the entire specified unit': function() {
				const units = nautilus.getUnitNames();
				const unitOne = nautilus.getUnitResults('student1', units[0]);
				const unitFive = nautilus.getUnitResults('student1', units[4]);
				assert(Array.isArray(unitOne));
				eq(unitOne.length, 24)
				assert(Array.isArray(unitFive));
				eq(unitFive.length, 24)
			},
			
			'each LO object should contain values for LO ID, status, best score, first score, attempts, time, LO name': function() {
				const units = nautilus.getUnitNames();
				const unitOne = nautilus.getUnitResults('student1', units[0]);
				const lo = unitOne[0];
				eq(typeof lo.LO_id, 'string');
				eq(typeof lo.status, 'string');
				eq(typeof lo.first_score, 'number' || 'string');
				eq(typeof lo.best_score, 'number' || 'string');
				eq(typeof lo.attempts, 'number');
				eq(typeof lo.active_time, 'number');
				eq(typeof lo.LO_name, 'string');
			},

			'it should not return any LOs which are not in the specified unit': function() {
				const units = nautilus.getUnitNames();
				const unitTwelve = nautilus.getUnitResults('student1', units[11]);
				let i = 0,
						len = unitTwelve.length;
				for (i; i < len; i++) {
					assert(unitTwelve[i].unit_name === units[11]);
				}
			},
			
			// nautilus.getUnitNames()
			'it should return an array with the names of each unit in the product': function() {
				const unitNames = nautilus.getUnitNames();
				eq(unitNames.length, 12);
				eq(unitNames[3], 'Unit 4');
			},
			
			// nautilus.getLessonNames(unitName)
			'it should return an array with the names of each lesson in the specified unit': function() {
				const unitNames = nautilus.getUnitNames(),
							u1 = unitNames[0],
							lessons = nautilus.getLessonNames(u1);
				eq(lessons.length, 5);
				eq(lessons[0], 'Lesson 1.1');
			},
			
			//nautilus.getUnitSummary(studentId, unitName)
			'it should return an object with properties aboveTarget, belowTarget and notStarted': function() {
				const summary = nautilus.getUnitSummary('student1', 'Unit 1');
				eq(typeof summary.aboveTarget, 'number');
				eq(typeof summary.belowTarget, 'number');
				eq(typeof summary.notStarted, 'number');
			},
			
			'it should aggregate status data for all LOs in the Unit': function() {
				const summary = nautilus.getUnitSummary('student1', 'Unit 1');
				eq(summary.aboveTarget + summary.belowTarget + summary.notStarted, 24);
			},
			
			//nautilus.getAllSummary(studentId)			
			'it should aggregate status data for all LOs in the product': function() {
				const summary = nautilus.getAllSummary('student1');
				eq(summary.aboveTarget + summary.belowTarget + summary.notStarted, 288);
			}

		});

	});

</script>